"use strict";var e=require("permissionless"),t=require("permissionless/accounts"),r=require("permissionless/clients/pimlico"),n=require("viem"),a=require("viem/account-abstraction"),i=require("@privy-io/public-api");let o={address:a.entryPoint06Address,version:"0.6"},s={address:a.entryPoint07Address,version:"0.7"},c=({owner:e,smartWalletType:r,publicClient:n})=>{switch(r){case i.SAFE:return t.toSafeSmartAccount({client:n,entryPoint:s,owners:[e],version:"1.4.1"});case i.KERNEL:return t.toKernelSmartAccount({client:n,version:"0.3.1",entryPoint:s,useMetaFactory:"optional",owners:[e]});case i.BICONOMY:return t.toBiconomySmartAccount({client:n,owners:[e],entryPoint:o});case i.LIGHT_ACCOUNT:return t.toLightSmartAccount({client:n,entryPoint:o,owner:e,version:"1.1.0"});case i.COINBASE_SMART_WALLET:return async function({client:e,owner:t}){let[r]=await t.request({method:"eth_accounts"});if(!r)throw Error("Unable to request embedded owner for eth_accounts");return await a.toCoinbaseSmartAccount({client:e,owners:[{type:"local",source:"privy",address:r,sign:async({hash:e})=>await t.request({method:"secp256k1_sign",params:[e]})}]})}({client:n,owner:e});case i.THIRDWEB:return t.toThirdwebSmartAccount({client:n,entryPoint:s,owner:e});default:throw Error(`Invalid smart account type: ${r}.`)}};exports.signerToSmartAccountClient=async({owner:t,smartWalletType:a,chain:i,publicClient:o,bundlerUrl:s,paymasterUrl:l,paymasterContext:u})=>{let m=await c({owner:t,smartWalletType:a,publicClient:o}),p=r.createPimlicoClient({transport:n.http(s),entryPoint:m.entryPoint}),y=l?r.createPimlicoClient({transport:n.http(l),entryPoint:m.entryPoint}):void 0;return e.createSmartAccountClient({account:m,chain:i,paymaster:y,paymasterContext:u,bundlerTransport:n.http(s),userOperation:{estimateFeesPerGas:async()=>{if(["public.pimlico.io","api.pimlico.io"].some((e=>s.includes(e))))return await p.getUserOperationGasPrice().then((e=>e.fast));if(["rpc.zerodev.app"].some((e=>s.includes(e))))return(await p.request({method:"zd_getUserOperationGasPrice",params:[]})).fast;if(["g.alchemy.com"].some((e=>s.includes(e)))){let[e,t]=await Promise.all([o.getBlock({blockTag:"latest"}),p.request({method:"rundler_maxPriorityFeePerGas",params:[]})]);if(!e.baseFeePerGas||!t)throw Error("Failed to get block or maxPriorityFeePerGasEstimate");return{maxFeePerGas:150n*e.baseFeePerGas/100n+BigInt(t.toString()),maxPriorityFeePerGas:BigInt(t.toString())}}{let e=await o.estimateFeesPerGas(),t=s.includes("api.developer.coinbase.com")?175n:150n;return{...e,maxFeePerGas:e.maxFeePerGas*t/100n,maxPriorityFeePerGas:e.maxPriorityFeePerGas*t/100n}}}}})};
